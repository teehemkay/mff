---
import { contentForPage } from '@packages/data';
import { kIndex } from '@packages/etl/constants';

import { zip } from '../js/utils.js';

import Header from './Header.astro';
import ShareWidget from './ShareWidget.astro';

interface Props {
  lang: string;
  currentPage: string;
  currentFAQ: string | null;
}

const { lang, currentPage, currentFAQ } = Astro.props;

const { homeH1: title, homeSubtitle: subtitle } = contentForPage(kIndex, lang);

const {
  pageH1: h1,
  pageChapo: chapo,
  faQuestion,
  faqAnswer,
  faqAnswerMeta,
  faqExpanded,
  faqID,
} = contentForPage(currentPage, lang);

const headerProps = { title, subtitle, h1, chapo, chapoIsContent: false };
const faqs = zip(faQuestion, faqAnswer, faqAnswerMeta, faqExpanded, faqID);
const shareWidgetProps = { lang, currentPage, title: faQuestion };
const shouldExpand = (status, faqID) =>
  currentFAQ === null ? status : `${currentFAQ === faqID}`;
---

<main role="main" id="mainContent" class="mb-8">
  <Header {...headerProps} />

  <div
    class="max-w-5xl lg:flex md:block sm:block block mx-auto justify-between items-center px-4 mb-72px">
    <ul
      class="expand-collapse max-w-5xl w-full [&>li]:border-b-2 [&>li]:border-black-greylight [&>li:last-of-type]:border-none">
      {
        faqs.map(([question, answer, _, expanded, faqID]) => (
          <li
            class="expand-container pt-36px mb-6"
            itemscope
            itemprop="mainEntity"
            itemtype="https://schema.org/Question">
            <h2 class="block pb-6">
              <button
                class="expand-button w-full text-left flex justify-between items-center py-2 hover:underline hover:decoration-1 hover:decoration-blue-default hover:underline-offset-4 focus:outline focus:outline-2 focus:outline-blue-focus focus:outline-offset-4"
                aria-expanded={shouldExpand(expanded, faqID)}
                aria-controls={`content-${faqID}`}
                itemprop="name">
                <span class="expand-title font-EPGammaBold">{question}</span>
                <svg aria-hidden="true" focusable="false" viewBox="0 0 10 9">
                  <rect class="vert" height="8" x="4.5" y="0.5" width="0.8" />
                  <rect width="8" y="4" x="1" height="0.8" />
                </svg>
              </button>
            </h2>
            <div
              id={`content-${faqID}`}
              class={`expand-container-content max-w-3xl pb-8${expanded === 'false' ? ' hidden' : ''}`}
              itemscope
              itemprop="acceptedAnswer"
              itemtype="https://schema.org/Answer">
              <div itemprop="text" set:html={answer} />

              {/*
              <ul class="video-list block lg:flex md:block sm:block">
                <li class="video-item mr-5">
                  <IframeVideo videoText="How the European Parliament supports citizensâ€™ in the next budget term" />
                  <Transcript />
                </li>
              </ul>
              */}

              <ShareWidget {...shareWidgetProps} {faqID} />
            </div>
          </li>
        ))
      }
    </ul>
  </div>
</main>
